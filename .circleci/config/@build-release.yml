### ***
### WARNING: DO NOT manually EDIT or MERGE this file, it is generated by 'make .circleci/config/@build-release.yml'.
### INSTEAD: Edit or merge the source in packages-oss.lock/pkgs.yml .circleci/config/@build-release.yml.tpl then run 'make .circleci/config/@build-release.yml'.
### ***
# Current cache version: cache000

executors:
  releaser:
    docker:
      - image: circleci/buildpack-deps
    environment:
      PRODUCT_REVISION: ""
      AUTO_INSTALL_TOOLS: 'YES'
    shell: /usr/bin/env bash -euo pipefail -c

workflows:
  build-release:
    jobs:
      - cache-builder-images:
          filters:
            branches:
              only:
                - /build-.*/
                - /ci.*/
      - darwin_386_package: { requires: [ cache-builder-images ] }
      - darwin_amd64_package: { requires: [ cache-builder-images ] }
      - freebsd_386_package: { requires: [ cache-builder-images ] }
      - freebsd_amd64_package: { requires: [ cache-builder-images ] }
      - freebsd_arm_package: { requires: [ cache-builder-images ] }
      - linux_386_package: { requires: [ cache-builder-images ] }
      - linux_amd64_package: { requires: [ cache-builder-images ] }
      - linux_arm_package: { requires: [ cache-builder-images ] }
      - linux_arm64_package: { requires: [ cache-builder-images ] }
      - netbsd_386_package: { requires: [ cache-builder-images ] }
      - netbsd_amd64_package: { requires: [ cache-builder-images ] }
      - openbsd_386_package: { requires: [ cache-builder-images ] }
      - openbsd_amd64_package: { requires: [ cache-builder-images ] }
      - solaris_amd64_package: { requires: [ cache-builder-images ] }
      - windows_386_package: { requires: [ cache-builder-images ] }
      - windows_amd64_package: { requires: [ cache-builder-images ] }
      - bundle-releases:
          requires:
            - darwin_386_package
            - darwin_amd64_package
            - freebsd_386_package
            - freebsd_amd64_package
            - freebsd_arm_package
            - linux_386_package
            - linux_amd64_package
            - linux_arm_package
            - linux_arm64_package
            - netbsd_386_package
            - netbsd_amd64_package
            - openbsd_386_package
            - openbsd_amd64_package
            - solaris_amd64_package
            - windows_386_package
            - windows_amd64_package
jobs:
  cache-builder-images:
    executor: releaser
    steps:
      - setup_remote_docker
      - checkout
      - write-build-layer-cache-keys

      # Load best available cached image.
      - restore_cache:
          keys:
            - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
            - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
            - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
            - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
            - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
            - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
            - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
            - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run:
          name: Finish early if loaded exact match from cache.
          command: |
            if [ -f .buildcache/archives/07-build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7.tar.gz ]; then
              echo "Exact match found in cache, skipping build."
              circleci-agent step halt
            else
              echo "No exact match found, proceeding with build."
            fi
      - run: LAYER_SPEC_ID=07-build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7 make -C packages*.lock load-builder-cache

      # No exact match was found, so build each layer up to target type.
      - run: make -f packages*.lock/layer.mk 00-base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c-image
      - run: make -f packages*.lock/layer.mk 01-install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64-image
      - run: make -f packages*.lock/layer.mk 02-install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f-image
      - run: make -f packages*.lock/layer.mk 03-set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe-image
      - run: make -f packages*.lock/layer.mk 04-install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09-image
      - run: make -f packages*.lock/layer.mk 05-ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b-image
      - run: make -f packages*.lock/layer.mk 06-build-ui-5fcd74915b08869b856272d3387411d1261f469e-image
      - run: make -f packages*.lock/layer.mk 07-build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7-image

      # Save the target layer archive.
      
      - run: make -f packages*.lock/layer.mk 07-build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7-save
      
      # Store the target layer archive as all the relevant cache names.
      - save_cache:
          key: cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          paths:
            - .buildcache/archives/07-build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7.tar.gz
      - run: mv .buildcache/archives/07-build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7.tar.gz .buildcache/archives/06-build-ui-5fcd74915b08869b856272d3387411d1261f469e.tar.gz
      - save_cache:
          key: cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          paths:
            - .buildcache/archives/06-build-ui-5fcd74915b08869b856272d3387411d1261f469e.tar.gz
      - run: mv .buildcache/archives/06-build-ui-5fcd74915b08869b856272d3387411d1261f469e.tar.gz .buildcache/archives/05-ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b.tar.gz
      - save_cache:
          key: cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          paths:
            - .buildcache/archives/05-ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b.tar.gz
      - run: mv .buildcache/archives/05-ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b.tar.gz .buildcache/archives/04-install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09.tar.gz
      - save_cache:
          key: cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          paths:
            - .buildcache/archives/04-install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09.tar.gz
      - run: mv .buildcache/archives/04-install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09.tar.gz .buildcache/archives/03-set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe.tar.gz
      - save_cache:
          key: cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          paths:
            - .buildcache/archives/03-set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe.tar.gz
      - run: mv .buildcache/archives/03-set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe.tar.gz .buildcache/archives/02-install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f.tar.gz
      - save_cache:
          key: cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          paths:
            - .buildcache/archives/02-install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f.tar.gz
      - run: mv .buildcache/archives/02-install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f.tar.gz .buildcache/archives/01-install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64.tar.gz
      - save_cache:
          key: cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          paths:
            - .buildcache/archives/01-install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64.tar.gz
      - run: mv .buildcache/archives/01-install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64.tar.gz .buildcache/archives/00-base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c.tar.gz
      - save_cache:
          key: cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
          paths:
            - .buildcache/archives/00-base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c.tar.gz
  darwin_386_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 7be0cb5096e6837586f7d3d72ada26ec6602912a
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-7be0cb5096e6837586f7d3d72ada26ec6602912a-{{checksum ".buildcache/cache-keys/package-7be0cb5096e6837586f7d3d72ada26ec6602912a"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_darwin_386.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_darwin_386.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_2ac8_{{checksum ".buildcache/cache-keys/copy-source-2ac8dd0bfbcc0c10c7a29eade0e8cb87c16a09e9"}}
          - cache000-warm-go-build-vendor-cache_a4c6_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-a4c6b877aeccec7aaf8d528d1b239254acea0823"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-7be0cb5096e6837586f7d3d72ada26ec6602912a-{{checksum ".buildcache/cache-keys/package-7be0cb5096e6837586f7d3d72ada26ec6602912a"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-a4c6b877aeccec7aaf8d528d1b239254acea0823.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-a4c6b877aeccec7aaf8d528d1b239254acea0823-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_a4c6_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-a4c6b877aeccec7aaf8d528d1b239254acea0823"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-a4c6b877aeccec7aaf8d528d1b239254acea0823.tar.gz

  darwin_amd64_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 6d5dedb2365057bf329e41fa1e003050623f6e63
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-6d5dedb2365057bf329e41fa1e003050623f6e63-{{checksum ".buildcache/cache-keys/package-6d5dedb2365057bf329e41fa1e003050623f6e63"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_darwin_amd64.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_darwin_amd64.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_948b_{{checksum ".buildcache/cache-keys/copy-source-948b79f05355cb5d1f37f231e53fc0723f2302a6"}}
          - cache000-warm-go-build-vendor-cache_3830_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-38306c8570075250506a515a20f34b5126c5837e"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-6d5dedb2365057bf329e41fa1e003050623f6e63-{{checksum ".buildcache/cache-keys/package-6d5dedb2365057bf329e41fa1e003050623f6e63"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-38306c8570075250506a515a20f34b5126c5837e.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-38306c8570075250506a515a20f34b5126c5837e-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_3830_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-38306c8570075250506a515a20f34b5126c5837e"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-38306c8570075250506a515a20f34b5126c5837e.tar.gz

  freebsd_386_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: e1d8b36fd0798b25979193f63e1e74d91c811ea0
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-e1d8b36fd0798b25979193f63e1e74d91c811ea0-{{checksum ".buildcache/cache-keys/package-e1d8b36fd0798b25979193f63e1e74d91c811ea0"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_freebsd_386.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_freebsd_386.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_5c2a_{{checksum ".buildcache/cache-keys/copy-source-5c2a10c6de9c3d4027e1095d18041257f4d7e943"}}
          - cache000-warm-go-build-vendor-cache_5729_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-5729c8912b854bf9b6cf8a0dc67e28bbd8ab681f"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-e1d8b36fd0798b25979193f63e1e74d91c811ea0-{{checksum ".buildcache/cache-keys/package-e1d8b36fd0798b25979193f63e1e74d91c811ea0"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-5729c8912b854bf9b6cf8a0dc67e28bbd8ab681f.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-5729c8912b854bf9b6cf8a0dc67e28bbd8ab681f-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_5729_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-5729c8912b854bf9b6cf8a0dc67e28bbd8ab681f"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-5729c8912b854bf9b6cf8a0dc67e28bbd8ab681f.tar.gz

  freebsd_amd64_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: bd9edf363edaf475d35b1486d84562b963e5f021
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-bd9edf363edaf475d35b1486d84562b963e5f021-{{checksum ".buildcache/cache-keys/package-bd9edf363edaf475d35b1486d84562b963e5f021"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_freebsd_amd64.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_freebsd_amd64.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_8e8e_{{checksum ".buildcache/cache-keys/copy-source-8e8e6a6afab100d225e1419642f61863b9e2bf8d"}}
          - cache000-warm-go-build-vendor-cache_fb9a_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-fb9a5ac9be401125f9141a649bff22b7f26a1e7b"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-bd9edf363edaf475d35b1486d84562b963e5f021-{{checksum ".buildcache/cache-keys/package-bd9edf363edaf475d35b1486d84562b963e5f021"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-fb9a5ac9be401125f9141a649bff22b7f26a1e7b.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-fb9a5ac9be401125f9141a649bff22b7f26a1e7b-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_fb9a_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-fb9a5ac9be401125f9141a649bff22b7f26a1e7b"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-fb9a5ac9be401125f9141a649bff22b7f26a1e7b.tar.gz

  freebsd_arm_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 5bbb2fb38c69f6f6fd89bee56ecbd59977b13f67
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-5bbb2fb38c69f6f6fd89bee56ecbd59977b13f67-{{checksum ".buildcache/cache-keys/package-5bbb2fb38c69f6f6fd89bee56ecbd59977b13f67"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_freebsd_arm.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_freebsd_arm.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_50d1_{{checksum ".buildcache/cache-keys/copy-source-50d1989c99d94e85afe4ff7d66da7b743251cae4"}}
          - cache000-warm-go-build-vendor-cache_d32c_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-d32c38a5770d69785d6cf47bee9655bc466ec3f3"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-5bbb2fb38c69f6f6fd89bee56ecbd59977b13f67-{{checksum ".buildcache/cache-keys/package-5bbb2fb38c69f6f6fd89bee56ecbd59977b13f67"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-d32c38a5770d69785d6cf47bee9655bc466ec3f3.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-d32c38a5770d69785d6cf47bee9655bc466ec3f3-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_d32c_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-d32c38a5770d69785d6cf47bee9655bc466ec3f3"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-d32c38a5770d69785d6cf47bee9655bc466ec3f3.tar.gz

  linux_386_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: f8c9461eb0716dc1f7ef964ee38e75d920ab4407
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-f8c9461eb0716dc1f7ef964ee38e75d920ab4407-{{checksum ".buildcache/cache-keys/package-f8c9461eb0716dc1f7ef964ee38e75d920ab4407"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_linux_386.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_linux_386.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_1b7d_{{checksum ".buildcache/cache-keys/copy-source-1b7df19ee44c9174b8be67aa6d81e24b04d12505"}}
          - cache000-warm-go-build-vendor-cache_be08_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-be081d5d75f0d4be93eae6ea865f6a89f2a6970e"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-f8c9461eb0716dc1f7ef964ee38e75d920ab4407-{{checksum ".buildcache/cache-keys/package-f8c9461eb0716dc1f7ef964ee38e75d920ab4407"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-be081d5d75f0d4be93eae6ea865f6a89f2a6970e.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-be081d5d75f0d4be93eae6ea865f6a89f2a6970e-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_be08_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-be081d5d75f0d4be93eae6ea865f6a89f2a6970e"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-be081d5d75f0d4be93eae6ea865f6a89f2a6970e.tar.gz

  linux_amd64_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 973acf219bb01602ef081f11b4f5334ddf85630e
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-973acf219bb01602ef081f11b4f5334ddf85630e-{{checksum ".buildcache/cache-keys/package-973acf219bb01602ef081f11b4f5334ddf85630e"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_linux_amd64.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_linux_amd64.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_83e2_{{checksum ".buildcache/cache-keys/copy-source-83e23bfb4502809b345f80221a5688c183d27308"}}
          - cache000-warm-go-build-vendor-cache_0ce8_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-0ce8e3ff723f31379bf6955716f58b70f3c5b48b"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-973acf219bb01602ef081f11b4f5334ddf85630e-{{checksum ".buildcache/cache-keys/package-973acf219bb01602ef081f11b4f5334ddf85630e"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-0ce8e3ff723f31379bf6955716f58b70f3c5b48b.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-0ce8e3ff723f31379bf6955716f58b70f3c5b48b-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_0ce8_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-0ce8e3ff723f31379bf6955716f58b70f3c5b48b"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-0ce8e3ff723f31379bf6955716f58b70f3c5b48b.tar.gz

  linux_arm_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 323dbfeda971185715ce54f69ca33812576ad02e
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-323dbfeda971185715ce54f69ca33812576ad02e-{{checksum ".buildcache/cache-keys/package-323dbfeda971185715ce54f69ca33812576ad02e"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_linux_arm.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_linux_arm.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_370f_{{checksum ".buildcache/cache-keys/copy-source-370ff09d97490bcfbfbaf940fa08d3420a27d318"}}
          - cache000-warm-go-build-vendor-cache_c5b5_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-c5b5fe7db5d96e53eb07a75aa90a8cd1cfc8bd51"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-323dbfeda971185715ce54f69ca33812576ad02e-{{checksum ".buildcache/cache-keys/package-323dbfeda971185715ce54f69ca33812576ad02e"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-c5b5fe7db5d96e53eb07a75aa90a8cd1cfc8bd51.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-c5b5fe7db5d96e53eb07a75aa90a8cd1cfc8bd51-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_c5b5_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-c5b5fe7db5d96e53eb07a75aa90a8cd1cfc8bd51"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-c5b5fe7db5d96e53eb07a75aa90a8cd1cfc8bd51.tar.gz

  linux_arm64_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 2fb4618edad7a94036e563fafb8539bf580995bb
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-2fb4618edad7a94036e563fafb8539bf580995bb-{{checksum ".buildcache/cache-keys/package-2fb4618edad7a94036e563fafb8539bf580995bb"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_linux_arm64.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_linux_arm64.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_db18_{{checksum ".buildcache/cache-keys/copy-source-db180a8ffb9c282015c63ad2827159ceeb27060c"}}
          - cache000-warm-go-build-vendor-cache_3d53_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-3d53a16a300d170d26c5ae1a1310cc5c40198b67"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-2fb4618edad7a94036e563fafb8539bf580995bb-{{checksum ".buildcache/cache-keys/package-2fb4618edad7a94036e563fafb8539bf580995bb"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-3d53a16a300d170d26c5ae1a1310cc5c40198b67.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-3d53a16a300d170d26c5ae1a1310cc5c40198b67-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_3d53_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-3d53a16a300d170d26c5ae1a1310cc5c40198b67"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-3d53a16a300d170d26c5ae1a1310cc5c40198b67.tar.gz

  netbsd_386_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 06c3256601a13c8dca0cd5017e9cbf632c45e250
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-06c3256601a13c8dca0cd5017e9cbf632c45e250-{{checksum ".buildcache/cache-keys/package-06c3256601a13c8dca0cd5017e9cbf632c45e250"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_netbsd_386.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_netbsd_386.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_1ba9_{{checksum ".buildcache/cache-keys/copy-source-1ba948d5850c8c18cba53445b2d7f179bbb43e1d"}}
          - cache000-warm-go-build-vendor-cache_385c_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-385c32eb530f9ccbd253f305f1e448ecc20f30e8"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-06c3256601a13c8dca0cd5017e9cbf632c45e250-{{checksum ".buildcache/cache-keys/package-06c3256601a13c8dca0cd5017e9cbf632c45e250"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-385c32eb530f9ccbd253f305f1e448ecc20f30e8.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-385c32eb530f9ccbd253f305f1e448ecc20f30e8-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_385c_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-385c32eb530f9ccbd253f305f1e448ecc20f30e8"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-385c32eb530f9ccbd253f305f1e448ecc20f30e8.tar.gz

  netbsd_amd64_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: a66d31290c635f3c00faad8f51a0d34ea35479d5
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-a66d31290c635f3c00faad8f51a0d34ea35479d5-{{checksum ".buildcache/cache-keys/package-a66d31290c635f3c00faad8f51a0d34ea35479d5"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_netbsd_amd64.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_netbsd_amd64.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_d910_{{checksum ".buildcache/cache-keys/copy-source-d910cc37ecf25331c53bb5ab27a817d63c36369f"}}
          - cache000-warm-go-build-vendor-cache_9bae_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-9bae6e7b584977ea7b1c927c05063f921eb6b859"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-a66d31290c635f3c00faad8f51a0d34ea35479d5-{{checksum ".buildcache/cache-keys/package-a66d31290c635f3c00faad8f51a0d34ea35479d5"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-9bae6e7b584977ea7b1c927c05063f921eb6b859.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-9bae6e7b584977ea7b1c927c05063f921eb6b859-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_9bae_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-9bae6e7b584977ea7b1c927c05063f921eb6b859"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-9bae6e7b584977ea7b1c927c05063f921eb6b859.tar.gz

  openbsd_386_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 44cb78682bd4bae4601067bef6dbdf8e9564e1ed
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-44cb78682bd4bae4601067bef6dbdf8e9564e1ed-{{checksum ".buildcache/cache-keys/package-44cb78682bd4bae4601067bef6dbdf8e9564e1ed"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_openbsd_386.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_openbsd_386.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_ac78_{{checksum ".buildcache/cache-keys/copy-source-ac78ccbf882bd5093c1f11080b6c86824c94d9d5"}}
          - cache000-warm-go-build-vendor-cache_26d1_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-26d1b9d805b71c8fdcb315e9903862d0cbfec92e"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-44cb78682bd4bae4601067bef6dbdf8e9564e1ed-{{checksum ".buildcache/cache-keys/package-44cb78682bd4bae4601067bef6dbdf8e9564e1ed"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-26d1b9d805b71c8fdcb315e9903862d0cbfec92e.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-26d1b9d805b71c8fdcb315e9903862d0cbfec92e-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_26d1_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-26d1b9d805b71c8fdcb315e9903862d0cbfec92e"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-26d1b9d805b71c8fdcb315e9903862d0cbfec92e.tar.gz

  openbsd_amd64_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 0440328bd0c4f4bdf8116742d01905c1f228fda5
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-0440328bd0c4f4bdf8116742d01905c1f228fda5-{{checksum ".buildcache/cache-keys/package-0440328bd0c4f4bdf8116742d01905c1f228fda5"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_openbsd_amd64.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_openbsd_amd64.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_c407_{{checksum ".buildcache/cache-keys/copy-source-c407468d8a2d3372007f0854b5f7aa142484f73f"}}
          - cache000-warm-go-build-vendor-cache_f3eb_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-f3eb0e446e517505d44a4dc41bdaa5afc37f9927"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-0440328bd0c4f4bdf8116742d01905c1f228fda5-{{checksum ".buildcache/cache-keys/package-0440328bd0c4f4bdf8116742d01905c1f228fda5"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-f3eb0e446e517505d44a4dc41bdaa5afc37f9927.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-f3eb0e446e517505d44a4dc41bdaa5afc37f9927-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_f3eb_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-f3eb0e446e517505d44a4dc41bdaa5afc37f9927"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-f3eb0e446e517505d44a4dc41bdaa5afc37f9927.tar.gz

  solaris_amd64_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: b5054c51fe4b50c218c9d0e79682fcad6b33ed17
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-b5054c51fe4b50c218c9d0e79682fcad6b33ed17-{{checksum ".buildcache/cache-keys/package-b5054c51fe4b50c218c9d0e79682fcad6b33ed17"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_solaris_amd64.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_solaris_amd64.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_f996_{{checksum ".buildcache/cache-keys/copy-source-f996a2732a6c1085f98ca073e548c35d4e49d383"}}
          - cache000-warm-go-build-vendor-cache_4941_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-4941033b883d2fed929c3f3a2b3abd43e75249c0"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-b5054c51fe4b50c218c9d0e79682fcad6b33ed17-{{checksum ".buildcache/cache-keys/package-b5054c51fe4b50c218c9d0e79682fcad6b33ed17"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-4941033b883d2fed929c3f3a2b3abd43e75249c0.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-4941033b883d2fed929c3f3a2b3abd43e75249c0-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_4941_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-4941033b883d2fed929c3f3a2b3abd43e75249c0"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-4941033b883d2fed929c3f3a2b3abd43e75249c0.tar.gz

  windows_386_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 7776d723d05efb78461df20f522adb349e4e2a68
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-7776d723d05efb78461df20f522adb349e4e2a68-{{checksum ".buildcache/cache-keys/package-7776d723d05efb78461df20f522adb349e4e2a68"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_windows_386.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_windows_386.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_8214_{{checksum ".buildcache/cache-keys/copy-source-8214166acaf73767767dd4981da1efef3f35bea9"}}
          - cache000-warm-go-build-vendor-cache_1da1_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-1da13aa79cf3ca9b34ff2e38e2176999b19bf960"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-7776d723d05efb78461df20f522adb349e4e2a68-{{checksum ".buildcache/cache-keys/package-7776d723d05efb78461df20f522adb349e4e2a68"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-1da13aa79cf3ca9b34ff2e38e2176999b19bf960.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-1da13aa79cf3ca9b34ff2e38e2176999b19bf960-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_1da1_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-1da13aa79cf3ca9b34ff2e38e2176999b19bf960"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-1da13aa79cf3ca9b34ff2e38e2176999b19bf960.tar.gz

  windows_amd64_package:
    executor: releaser
    environment:
      - PACKAGE_SPEC_ID: 6e7516d1674ac957851e588d82b8a6eec75b48a3
    steps:
      - setup_remote_docker
      - checkout

      # Restore the package cache first, we might not need to rebuild.
      - write-package-cache-key
      - restore_cache:
          key: 'cache000-package-6e7516d1674ac957851e588d82b8a6eec75b48a3-{{checksum ".buildcache/cache-keys/package-6e7516d1674ac957851e588d82b8a6eec75b48a3"}}'
      - run:
          name: Check the cache status.
          command: |
            if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
              echo "No package found, continuing with build."
              exit 0
            fi
            # Check the aliases are right, as they are metadata not included in
            # the cache key. If they're wrong, it's time to bust cache.
            for ALIAS in .buildcache/packages/by-alias/local/vault_0.0.0-snapshot+_windows_amd64.zip .buildcache/packages/by-alias/public-hc-releases/vault/vault_0.0.0-snapshot+/vault_0.0.0-snapshot+_windows_amd64.zip ; do
              echo "Checking alias: $ALIAS"
              if ! readlink $ALIAS; then
                echo "Missing alias: $ALIAS"
                echo "Please increment the cache version to fix this issue."
                { { apt-get update && apt-get install -y tree; } > /dev/null 2>&1 && tree .buildcache/packages; } || true
                exit 1
              fi
            done
            echo "Package already cached, skipping build."
            circleci-agent step halt

      # We need to rebuild, so load the builder cache.
      - write-build-layer-cache-keys
      - restore_cache:
          keys:
          - cache000-copy-source_044c_{{checksum ".buildcache/cache-keys/copy-source-044c1ad12868e18fe02c3f29c946df079e95fa7f"}}
          - cache000-warm-go-build-vendor-cache_7906_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-79069e4640672e19084d4887a6f3eebe09d04519"}}
          - cache000-build-static-assets_7c21_{{checksum ".buildcache/cache-keys/build-static-assets-7c21467f4fca7255898d0c54159292ccfa87d6f7"}}
          - cache000-build-ui_5fcd_{{checksum ".buildcache/cache-keys/build-ui-5fcd74915b08869b856272d3387411d1261f469e"}}
          - cache000-ui-dependencies_7c1e_{{checksum ".buildcache/cache-keys/ui-dependencies-7c1e694ad5c5ec290f4b684b27b53e94b5e6508b"}}
          - cache000-install-yarn_985d_{{checksum ".buildcache/cache-keys/install-yarn-985d5d3f752a45cd0810fe7307419d816b3ffe09"}}
          - cache000-set-workdir_fe53_{{checksum ".buildcache/cache-keys/set-workdir-fe5358938453e5f6f63543c5ae1835424c7b8cbe"}}
          - cache000-install-go-tools_c2aa_{{checksum ".buildcache/cache-keys/install-go-tools-c2aad8477b1bc51dcb25518de1a7c6402dc3941f"}}
          - cache000-install-go_597a_{{checksum ".buildcache/cache-keys/install-go-597a1a15bf2e74b06883d2b2bb2e7239cb9b9c64"}}
          - cache000-base_1a0e_{{checksum ".buildcache/cache-keys/base-1a0eebdb7c8e017a66a042afd9f319a57d761a4c"}}
      - run: make -C packages*.lock load-builder-cache
      - run: make -C packages*.lock package
      - run: ls -lahR .buildcache/packages
      # Save package cache.
      - save_cache:
          key: 'cache000-package-6e7516d1674ac957851e588d82b8a6eec75b48a3-{{checksum ".buildcache/cache-keys/package-6e7516d1674ac957851e588d82b8a6eec75b48a3"}}'
          paths:
            - .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      # Save builder image cache if necessary.
      # The range should only iterate over a single layer.
      - run:
          name: Check builder cache status
          command: |
            if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-79069e4640672e19084d4887a6f3eebe09d04519.tar.gz ]; then
              echo "Builder image already cached, skipping cache step."
              circleci-agent step halt
            fi
      - run: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-79069e4640672e19084d4887a6f3eebe09d04519-save
      - save_cache:
          key: 'cache000-warm-go-build-vendor-cache_7906_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-79069e4640672e19084d4887a6f3eebe09d04519"}}'
          paths:
            - .buildcache/archives/08-warm-go-build-vendor-cache-79069e4640672e19084d4887a6f3eebe09d04519.tar.gz


  bundle-releases:
    executor: releaser
    steps:
      - checkout
      - write-all-package-cache-keys
      - load-darwin_386_package
      - load-darwin_amd64_package
      - load-freebsd_386_package
      - load-freebsd_amd64_package
      - load-freebsd_arm_package
      - load-linux_386_package
      - load-linux_amd64_package
      - load-linux_arm_package
      - load-linux_arm64_package
      - load-netbsd_386_package
      - load-netbsd_amd64_package
      - load-openbsd_386_package
      - load-openbsd_amd64_package
      - load-solaris_amd64_package
      - load-windows_386_package
      - load-windows_amd64_package
      - run: ls -lahR .buildcache/packages
      - store_artifacts:
          path: .buildcache/packages
          destination: packages
      - run: tar -czf packages.tar.gz .buildcache/packages
      - store_artifacts:
          path: packages.tar.gz
          destination: packages.tar.gz

commands:
  load-darwin_386_package:
    steps:
      - restore_cache:
          key: 'cache000-package-7be0cb5096e6837586f7d3d72ada26ec6602912a-{{checksum ".buildcache/cache-keys/package-7be0cb5096e6837586f7d3d72ada26ec6602912a"}}'
  
  load-darwin_amd64_package:
    steps:
      - restore_cache:
          key: 'cache000-package-6d5dedb2365057bf329e41fa1e003050623f6e63-{{checksum ".buildcache/cache-keys/package-6d5dedb2365057bf329e41fa1e003050623f6e63"}}'
  
  load-freebsd_386_package:
    steps:
      - restore_cache:
          key: 'cache000-package-e1d8b36fd0798b25979193f63e1e74d91c811ea0-{{checksum ".buildcache/cache-keys/package-e1d8b36fd0798b25979193f63e1e74d91c811ea0"}}'
  
  load-freebsd_amd64_package:
    steps:
      - restore_cache:
          key: 'cache000-package-bd9edf363edaf475d35b1486d84562b963e5f021-{{checksum ".buildcache/cache-keys/package-bd9edf363edaf475d35b1486d84562b963e5f021"}}'
  
  load-freebsd_arm_package:
    steps:
      - restore_cache:
          key: 'cache000-package-5bbb2fb38c69f6f6fd89bee56ecbd59977b13f67-{{checksum ".buildcache/cache-keys/package-5bbb2fb38c69f6f6fd89bee56ecbd59977b13f67"}}'
  
  load-linux_386_package:
    steps:
      - restore_cache:
          key: 'cache000-package-f8c9461eb0716dc1f7ef964ee38e75d920ab4407-{{checksum ".buildcache/cache-keys/package-f8c9461eb0716dc1f7ef964ee38e75d920ab4407"}}'
  
  load-linux_amd64_package:
    steps:
      - restore_cache:
          key: 'cache000-package-973acf219bb01602ef081f11b4f5334ddf85630e-{{checksum ".buildcache/cache-keys/package-973acf219bb01602ef081f11b4f5334ddf85630e"}}'
  
  load-linux_arm_package:
    steps:
      - restore_cache:
          key: 'cache000-package-323dbfeda971185715ce54f69ca33812576ad02e-{{checksum ".buildcache/cache-keys/package-323dbfeda971185715ce54f69ca33812576ad02e"}}'
  
  load-linux_arm64_package:
    steps:
      - restore_cache:
          key: 'cache000-package-2fb4618edad7a94036e563fafb8539bf580995bb-{{checksum ".buildcache/cache-keys/package-2fb4618edad7a94036e563fafb8539bf580995bb"}}'
  
  load-netbsd_386_package:
    steps:
      - restore_cache:
          key: 'cache000-package-06c3256601a13c8dca0cd5017e9cbf632c45e250-{{checksum ".buildcache/cache-keys/package-06c3256601a13c8dca0cd5017e9cbf632c45e250"}}'
  
  load-netbsd_amd64_package:
    steps:
      - restore_cache:
          key: 'cache000-package-a66d31290c635f3c00faad8f51a0d34ea35479d5-{{checksum ".buildcache/cache-keys/package-a66d31290c635f3c00faad8f51a0d34ea35479d5"}}'
  
  load-openbsd_386_package:
    steps:
      - restore_cache:
          key: 'cache000-package-44cb78682bd4bae4601067bef6dbdf8e9564e1ed-{{checksum ".buildcache/cache-keys/package-44cb78682bd4bae4601067bef6dbdf8e9564e1ed"}}'
  
  load-openbsd_amd64_package:
    steps:
      - restore_cache:
          key: 'cache000-package-0440328bd0c4f4bdf8116742d01905c1f228fda5-{{checksum ".buildcache/cache-keys/package-0440328bd0c4f4bdf8116742d01905c1f228fda5"}}'
  
  load-solaris_amd64_package:
    steps:
      - restore_cache:
          key: 'cache000-package-b5054c51fe4b50c218c9d0e79682fcad6b33ed17-{{checksum ".buildcache/cache-keys/package-b5054c51fe4b50c218c9d0e79682fcad6b33ed17"}}'
  
  load-windows_386_package:
    steps:
      - restore_cache:
          key: 'cache000-package-7776d723d05efb78461df20f522adb349e4e2a68-{{checksum ".buildcache/cache-keys/package-7776d723d05efb78461df20f522adb349e4e2a68"}}'
  
  load-windows_amd64_package:
    steps:
      - restore_cache:
          key: 'cache000-package-6e7516d1674ac957851e588d82b8a6eec75b48a3-{{checksum ".buildcache/cache-keys/package-6e7516d1674ac957851e588d82b8a6eec75b48a3"}}'
  

  write-build-layer-cache-keys:
    steps:
      - run:
          name: Write builder layer cache keys
          command: make -C packages*.lock write-builder-cache-keys

  write-package-cache-key:
    steps:
      - run:
          name: Write package cache key
          command: make -C packages*.lock write-package-cache-key

  write-all-package-cache-keys:
    steps:
      - run:
          name: Write package cache key
          command: make -C packages*.lock write-all-package-cache-keys
