### ***
### WARNING: DO NOT manually EDIT or MERGE this file, it is generated by 'make ci-config'.
### INSTEAD: Edit or merge the source in config/ then run 'make ci-config'.
### ***
# Orb 'circleci/slack@3.2.0' resolved to 'circleci/slack@3.2.0'
version: 2
jobs:
  bundle-releases:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    steps:
    - checkout
    - run:
        command: make -C packages*.lock write-all-package-cache-keys
        name: Write package cache key
    - restore_cache:
        key: cache002-package-3427cd2548869464b1e3617ccd5c47e08d8c8813-{{checksum ".buildcache/cache-keys/package-3427cd2548869464b1e3617ccd5c47e08d8c8813"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 3427cd2548869464b1e3617ccd5c47e08d8c8813
        name: Write package metadata for darwin_386_package
    - restore_cache:
        key: cache002-package-0c26c88c1b86e2e848a512f42887a2465dce9f67-{{checksum ".buildcache/cache-keys/package-0c26c88c1b86e2e848a512f42887a2465dce9f67"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 0c26c88c1b86e2e848a512f42887a2465dce9f67
        name: Write package metadata for darwin_amd64_package
    - restore_cache:
        key: cache002-package-20d965965a73511f1384b33360bab71d6a25fc72-{{checksum ".buildcache/cache-keys/package-20d965965a73511f1384b33360bab71d6a25fc72"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 20d965965a73511f1384b33360bab71d6a25fc72
        name: Write package metadata for freebsd_386_package
    - restore_cache:
        key: cache002-package-93917bd9972eed22415501742f89d21e8bebd281-{{checksum ".buildcache/cache-keys/package-93917bd9972eed22415501742f89d21e8bebd281"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 93917bd9972eed22415501742f89d21e8bebd281
        name: Write package metadata for freebsd_amd64_package
    - restore_cache:
        key: cache002-package-20b84978b1b77380d2963c90721181a835fab182-{{checksum ".buildcache/cache-keys/package-20b84978b1b77380d2963c90721181a835fab182"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 20b84978b1b77380d2963c90721181a835fab182
        name: Write package metadata for freebsd_arm_package
    - restore_cache:
        key: cache002-package-96e6d6112c2e11aff9ebf0d44d87514c69809586-{{checksum ".buildcache/cache-keys/package-96e6d6112c2e11aff9ebf0d44d87514c69809586"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 96e6d6112c2e11aff9ebf0d44d87514c69809586
        name: Write package metadata for linux_386_package
    - restore_cache:
        key: cache002-package-a11941fd63ecbc9af6a2b532a98a9cf45411f938-{{checksum ".buildcache/cache-keys/package-a11941fd63ecbc9af6a2b532a98a9cf45411f938"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: a11941fd63ecbc9af6a2b532a98a9cf45411f938
        name: Write package metadata for linux_amd64_package
    - restore_cache:
        key: cache002-package-e07e8215656179df21e945329e9be509211112ad-{{checksum ".buildcache/cache-keys/package-e07e8215656179df21e945329e9be509211112ad"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: e07e8215656179df21e945329e9be509211112ad
        name: Write package metadata for linux_arm_package
    - restore_cache:
        key: cache002-package-16e5df7b85564e1637ad05170a486f2a7e09fe1f-{{checksum ".buildcache/cache-keys/package-16e5df7b85564e1637ad05170a486f2a7e09fe1f"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 16e5df7b85564e1637ad05170a486f2a7e09fe1f
        name: Write package metadata for linux_arm64_package
    - restore_cache:
        key: cache002-package-0ba2003857d2baed36f1c8c59765117d05fca5d1-{{checksum ".buildcache/cache-keys/package-0ba2003857d2baed36f1c8c59765117d05fca5d1"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 0ba2003857d2baed36f1c8c59765117d05fca5d1
        name: Write package metadata for netbsd_386_package
    - restore_cache:
        key: cache002-package-dc3a69ebdc0a3822522ea90cc911e6a2504ff8cd-{{checksum ".buildcache/cache-keys/package-dc3a69ebdc0a3822522ea90cc911e6a2504ff8cd"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: dc3a69ebdc0a3822522ea90cc911e6a2504ff8cd
        name: Write package metadata for netbsd_amd64_package
    - restore_cache:
        key: cache002-package-ba54c95ec3694d2a055859925dea597e18243034-{{checksum ".buildcache/cache-keys/package-ba54c95ec3694d2a055859925dea597e18243034"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: ba54c95ec3694d2a055859925dea597e18243034
        name: Write package metadata for openbsd_386_package
    - restore_cache:
        key: cache002-package-4a09f8a877207aa3e5511fe093e7248a4c8d8db0-{{checksum ".buildcache/cache-keys/package-4a09f8a877207aa3e5511fe093e7248a4c8d8db0"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 4a09f8a877207aa3e5511fe093e7248a4c8d8db0
        name: Write package metadata for openbsd_amd64_package
    - restore_cache:
        key: cache002-package-fffa6d15a1e6ba541a04147a0bbf06753491fc8c-{{checksum ".buildcache/cache-keys/package-fffa6d15a1e6ba541a04147a0bbf06753491fc8c"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: fffa6d15a1e6ba541a04147a0bbf06753491fc8c
        name: Write package metadata for solaris_amd64_package
    - restore_cache:
        key: cache002-package-8ab92b20328ec4b9a41f7ca72e43a09c4d3f385f-{{checksum ".buildcache/cache-keys/package-8ab92b20328ec4b9a41f7ca72e43a09c4d3f385f"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: 8ab92b20328ec4b9a41f7ca72e43a09c4d3f385f
        name: Write package metadata for windows_386_package
    - restore_cache:
        key: cache002-package-b2d3a544e74f5fa8cde087067748a7b9948f4ae4-{{checksum ".buildcache/cache-keys/package-b2d3a544e74f5fa8cde087067748a7b9948f4ae4"}}
    - run:
        command: |
          make package-meta
        environment:
          PACKAGE_SPEC_ID: b2d3a544e74f5fa8cde087067748a7b9948f4ae4
        name: Write package metadata for windows_amd64_package
    - run:
        command: make aliases
        name: Write package aliases
    - run:
        command: ls -lahR .buildcache
        name: List Build Cache
    - store_artifacts:
        destination: packages-standalone
        path: .buildcache/packages
    - run:
        command: tar -czf packages-standalone.tar.gz .buildcache/packages
    - store_artifacts:
        destination: packages-standalone.tar.gz
        path: packages-standalone.tar.gz
    - run:
        command: tar -czf meta-standalone.tar.gz .buildcache/packages/store/*.json
    - store_artifacts:
        destination: meta-standalone.tar.gz
        path: meta-standalone.tar.gz
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
  darwin_amd64_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 0c26c88c1b86e2e848a512f42887a2465dce9f67
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-0c26c88c1b86e2e848a512f42887a2465dce9f67-{{checksum ".buildcache/cache-keys/package-0c26c88c1b86e2e848a512f42887a2465dce9f67"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_ec15_{{checksum ".buildcache/cache-keys/copy-source-ec15cb67f6aac635fa52d676de2a1944c53fb955"}}
        - cache002-warm-go-build-vendor-cache_f055_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-f055938f562f0df01070ddf405ee499fd314cb65"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-0c26c88c1b86e2e848a512f42887a2465dce9f67-{{checksum ".buildcache/cache-keys/package-0c26c88c1b86e2e848a512f42887a2465dce9f67"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-f055938f562f0df01070ddf405ee499fd314cb65.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-f055938f562f0df01070ddf405ee499fd314cb65-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_f055_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-f055938f562f0df01070ddf405ee499fd314cb65"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-f055938f562f0df01070ddf405ee499fd314cb65.tar.gz
  windows_386_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 8ab92b20328ec4b9a41f7ca72e43a09c4d3f385f
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-8ab92b20328ec4b9a41f7ca72e43a09c4d3f385f-{{checksum ".buildcache/cache-keys/package-8ab92b20328ec4b9a41f7ca72e43a09c4d3f385f"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_dae0_{{checksum ".buildcache/cache-keys/copy-source-dae0b5d2d66e62f94f1bf59aa971a742af27d609"}}
        - cache002-warm-go-build-vendor-cache_8eee_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-8eee2c11ac7d5bc7fe8a5c6158580288df31ccf2"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-8ab92b20328ec4b9a41f7ca72e43a09c4d3f385f-{{checksum ".buildcache/cache-keys/package-8ab92b20328ec4b9a41f7ca72e43a09c4d3f385f"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-8eee2c11ac7d5bc7fe8a5c6158580288df31ccf2.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-8eee2c11ac7d5bc7fe8a5c6158580288df31ccf2-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_8eee_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-8eee2c11ac7d5bc7fe8a5c6158580288df31ccf2"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-8eee2c11ac7d5bc7fe8a5c6158580288df31ccf2.tar.gz
  install-ui-dependencies:
    docker:
    - image: node:10-buster
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/vault
    steps:
    - checkout
    - restore_cache:
        key: yarn-lock-v6-{{ checksum "ui/yarn.lock" }}
    - run:
        command: |
          cd ui
          yarn install
          npm rebuild node-sass
        name: Install UI dependencies
    - save_cache:
        key: yarn-lock-v6-{{ checksum "ui/yarn.lock" }}
        paths:
        - ui/node_modules
  linux_arm64_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 16e5df7b85564e1637ad05170a486f2a7e09fe1f
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-16e5df7b85564e1637ad05170a486f2a7e09fe1f-{{checksum ".buildcache/cache-keys/package-16e5df7b85564e1637ad05170a486f2a7e09fe1f"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_65e2_{{checksum ".buildcache/cache-keys/copy-source-65e2103271a2fa887a1af64ba9a8e2bf6f0caf9f"}}
        - cache002-warm-go-build-vendor-cache_357d_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-357d85ca627884423b73aede44469e461384a580"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-16e5df7b85564e1637ad05170a486f2a7e09fe1f-{{checksum ".buildcache/cache-keys/package-16e5df7b85564e1637ad05170a486f2a7e09fe1f"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-357d85ca627884423b73aede44469e461384a580.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-357d85ca627884423b73aede44469e461384a580-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_357d_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-357d85ca627884423b73aede44469e461384a580"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-357d85ca627884423b73aede44469e461384a580.tar.gz
  test-ui:
    docker:
    - image: node:10-buster
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/vault
    resource_class: medium+
    steps:
    - checkout
    - restore_cache:
        key: yarn-lock-v6-{{ checksum "ui/yarn.lock" }}
    - attach_workspace:
        at: .
    - run:
        command: |
          set -x

          # Install Chrome
          wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub \
            | apt-key add -
          echo "deb http://dl.google.com/linux/chrome/deb/ stable main" \
            | tee /etc/apt/sources.list.d/google-chrome.list
          apt-get update
          apt-get -y install google-chrome-stable
          rm /etc/apt/sources.list.d/google-chrome.list
          rm -rf /var/lib/apt/lists/* /var/cache/apt/*

          # Add ./bin to the PATH so vault binary can be run by Ember tests
          export PATH="${PWD}/bin:${PATH}"

          # Run Ember tests
          cd ui
          mkdir -p test-results/qunit
          yarn test:oss
        name: Test UI
    - store_artifacts:
        path: ui/test-results
    - store_test_results:
        path: ui/test-results
  linux_arm_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: e07e8215656179df21e945329e9be509211112ad
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-e07e8215656179df21e945329e9be509211112ad-{{checksum ".buildcache/cache-keys/package-e07e8215656179df21e945329e9be509211112ad"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_a227_{{checksum ".buildcache/cache-keys/copy-source-a227eaabba5c2dd3f5a7c413077364f400429d8c"}}
        - cache002-warm-go-build-vendor-cache_e649_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-e6493927774da26dc5dc988d6b66ab94d773938e"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-e07e8215656179df21e945329e9be509211112ad-{{checksum ".buildcache/cache-keys/package-e07e8215656179df21e945329e9be509211112ad"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-e6493927774da26dc5dc988d6b66ab94d773938e.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-e6493927774da26dc5dc988d6b66ab94d773938e-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_e649_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-e6493927774da26dc5dc988d6b66ab94d773938e"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-e6493927774da26dc5dc988d6b66ab94d773938e.tar.gz
  test-ui-browserstack:
    docker:
    - image: node:10-buster
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/vault
    resource_class: medium+
    steps:
    - checkout
    - restore_cache:
        key: yarn-lock-v6-{{ checksum "ui/yarn.lock" }}
    - attach_workspace:
        at: .
    - run:
        command: |
          # Add ./bin to the PATH so vault binary can be found.
          export PATH="${PWD}"/bin:${PATH}
          make test-ui-browserstack
        name: Run Browserstack Tests
  darwin_386_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 3427cd2548869464b1e3617ccd5c47e08d8c8813
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-3427cd2548869464b1e3617ccd5c47e08d8c8813-{{checksum ".buildcache/cache-keys/package-3427cd2548869464b1e3617ccd5c47e08d8c8813"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_1e15_{{checksum ".buildcache/cache-keys/copy-source-1e15b997b0451457c36f3bdda18f0745a0b58ff6"}}
        - cache002-warm-go-build-vendor-cache_804f_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-804fab5f34fb2f76ca81989cb41a04141dae144c"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-3427cd2548869464b1e3617ccd5c47e08d8c8813-{{checksum ".buildcache/cache-keys/package-3427cd2548869464b1e3617ccd5c47e08d8c8813"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-804fab5f34fb2f76ca81989cb41a04141dae144c.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-804fab5f34fb2f76ca81989cb41a04141dae144c-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_804f_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-804fab5f34fb2f76ca81989cb41a04141dae144c"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-804fab5f34fb2f76ca81989cb41a04141dae144c.tar.gz
  build-go-dev:
    machine: true
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/vault
    steps:
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          sudo rm -rf /usr/local/go
          sudo tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { sudo mkdir $GOPATH && sudo chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"

          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - attach_workspace:
        at: .
    - run:
        command: |
          # Move dev UI assets to expected location
          rm -rf ./pkg
          mkdir ./pkg

          # Build dev binary
          make ci-bootstrap dev
        name: Build dev binary
    - persist_to_workspace:
        paths:
        - bin
        root: .
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.5546
    - GO_TAGS: ''
    - GO_VERSION: 1.14.7
    - GO111MODULE: 'off'
    - GOTESTSUM_VERSION: 0.5.2
  algolia-index:
    docker:
    - image: node:12
    steps:
    - checkout
    - run:
        command: |
          if  [ "$CIRCLE_REPOSITORY_URL" != "git@github.com:hashicorp/vault.git" ]; then
            echo "Not Vault OSS Repo, not indexing Algolia"
            exit 0
          fi
          cd website/
          npm install
          node scripts/index_search_content.js
        name: Push content to Algolia Index
  linux_386_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 96e6d6112c2e11aff9ebf0d44d87514c69809586
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-96e6d6112c2e11aff9ebf0d44d87514c69809586-{{checksum ".buildcache/cache-keys/package-96e6d6112c2e11aff9ebf0d44d87514c69809586"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_5625_{{checksum ".buildcache/cache-keys/copy-source-5625def626a1b61c8fdfb1e32334f943f2f49c8a"}}
        - cache002-warm-go-build-vendor-cache_34c3_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-34c310e0b7b3743e7339d0bc61336ef1696ad3f8"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-96e6d6112c2e11aff9ebf0d44d87514c69809586-{{checksum ".buildcache/cache-keys/package-96e6d6112c2e11aff9ebf0d44d87514c69809586"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-34c310e0b7b3743e7339d0bc61336ef1696ad3f8.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-34c310e0b7b3743e7339d0bc61336ef1696ad3f8-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_34c3_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-34c310e0b7b3743e7339d0bc61336ef1696ad3f8"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-34c310e0b7b3743e7339d0bc61336ef1696ad3f8.tar.gz
  freebsd_386_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 20d965965a73511f1384b33360bab71d6a25fc72
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-20d965965a73511f1384b33360bab71d6a25fc72-{{checksum ".buildcache/cache-keys/package-20d965965a73511f1384b33360bab71d6a25fc72"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_5cf5_{{checksum ".buildcache/cache-keys/copy-source-5cf5a53d733e58983156078f990cf9bfd30dc9fd"}}
        - cache002-warm-go-build-vendor-cache_be40_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-be40bc2a89a1f9b5f22a5684cd086dff7b309e9c"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-20d965965a73511f1384b33360bab71d6a25fc72-{{checksum ".buildcache/cache-keys/package-20d965965a73511f1384b33360bab71d6a25fc72"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-be40bc2a89a1f9b5f22a5684cd086dff7b309e9c.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-be40bc2a89a1f9b5f22a5684cd086dff7b309e9c-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_be40_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-be40bc2a89a1f9b5f22a5684cd086dff7b309e9c"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-be40bc2a89a1f9b5f22a5684cd086dff7b309e9c.tar.gz
  test-go-race:
    machine: true
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/vault
    steps:
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          sudo rm -rf /usr/local/go
          sudo tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { sudo mkdir $GOPATH && sudo chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"

          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: |
          TZ=GMT date '+%Y%m%d' > /tmp/go-cache-key
        name: Compute test cache key
    - restore_cache:
        keys:
        - go-test-cache-date-v1-{{ checksum "/tmp/go-cache-key" }}
    - run:
        command: |
          set -x

          case "-race" in
          *-race*) VAULT_CI_GO_TEST_RACE=1;;
          esac

          # Install CircleCI CLI
          curl -sSL \
              "https://github.com/CircleCI-Public/circleci-cli/releases/download/v${CIRCLECI_CLI_VERSION}/circleci-cli_${CIRCLECI_CLI_VERSION}_linux_amd64.tar.gz" \
            | sudo tar --overwrite -xz \
              -C /usr/local/bin \
              "circleci-cli_${CIRCLECI_CLI_VERSION}_linux_amd64/circleci"

          # Split Go tests by prior test times
          package_names=$(go list \
              -tags "${GO_TAGS}" \
              ./... \
            | grep -v /integ \
            | grep -v /vendor/ \
            | sort \
            | circleci tests split --split-by=timings --timings-type=classname)

          # Install gotestsum
          curl -sSL "https://github.com/gotestyourself/gotestsum/releases/download/v${GOTESTSUM_VERSION}/gotestsum_${GOTESTSUM_VERSION}_linux_amd64.tar.gz" \
            | sudo tar --overwrite -xz -C /usr/local/bin gotestsum

          # Run tests
          make prep
          mkdir -p test-results/go-test
          CGO_ENABLED= \
            VAULT_ADDR= \
            VAULT_TOKEN= \
            VAULT_DEV_ROOT_TOKEN_ID= \
            VAULT_ACC= \
            GOCACHE=/tmp/go-cache \
            VAULT_TEST_LOG_DIR=/tmp/testlogs \
            gotestsum --format=short-verbose \
              --junitfile test-results/go-test/results.xml \
              --jsonfile test-results/go-test/results.json \
              -- \
              -tags "${GO_TAGS}" \
              -timeout=60m \
              -parallel=20 \
              -race \
              ${package_names}
        name: Run Go tests
        no_output_timeout: 60m
    - store_artifacts:
        path: test-results
    - store_test_results:
        path: test-results
    - store_artifacts:
        path: /tmp/testlogs
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.5546
    - GO_TAGS: ''
    - GO_VERSION: 1.14.7
    - GO111MODULE: 'off'
    - GOTESTSUM_VERSION: 0.5.2
  freebsd_amd64_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 93917bd9972eed22415501742f89d21e8bebd281
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-93917bd9972eed22415501742f89d21e8bebd281-{{checksum ".buildcache/cache-keys/package-93917bd9972eed22415501742f89d21e8bebd281"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_3773_{{checksum ".buildcache/cache-keys/copy-source-37732486c3638f206a421d4b8821da90a6e171e5"}}
        - cache002-warm-go-build-vendor-cache_6e00_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-6e00337b3bf000b518e389290994372fcf94ccd7"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-93917bd9972eed22415501742f89d21e8bebd281-{{checksum ".buildcache/cache-keys/package-93917bd9972eed22415501742f89d21e8bebd281"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-6e00337b3bf000b518e389290994372fcf94ccd7.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-6e00337b3bf000b518e389290994372fcf94ccd7-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_6e00_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-6e00337b3bf000b518e389290994372fcf94ccd7"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-6e00337b3bf000b518e389290994372fcf94ccd7.tar.gz
  openbsd_386_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: ba54c95ec3694d2a055859925dea597e18243034
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-ba54c95ec3694d2a055859925dea597e18243034-{{checksum ".buildcache/cache-keys/package-ba54c95ec3694d2a055859925dea597e18243034"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_ed64_{{checksum ".buildcache/cache-keys/copy-source-ed643361006603077ab0d5f815b6bedf5123ebc5"}}
        - cache002-warm-go-build-vendor-cache_4ee8_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-4ee8c58c81a6c54ff5847d9b525d406fd30271cc"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-ba54c95ec3694d2a055859925dea597e18243034-{{checksum ".buildcache/cache-keys/package-ba54c95ec3694d2a055859925dea597e18243034"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-4ee8c58c81a6c54ff5847d9b525d406fd30271cc.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-4ee8c58c81a6c54ff5847d9b525d406fd30271cc-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_4ee8_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-4ee8c58c81a6c54ff5847d9b525d406fd30271cc"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-4ee8c58c81a6c54ff5847d9b525d406fd30271cc.tar.gz
  linux_amd64_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: a11941fd63ecbc9af6a2b532a98a9cf45411f938
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-a11941fd63ecbc9af6a2b532a98a9cf45411f938-{{checksum ".buildcache/cache-keys/package-a11941fd63ecbc9af6a2b532a98a9cf45411f938"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_037c_{{checksum ".buildcache/cache-keys/copy-source-037c2b4d410fc926b14e42f8bb938db367e7d7ca"}}
        - cache002-warm-go-build-vendor-cache_5a16_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-5a1666d67ac28507b7da6163f468e4f7b54ba2ca"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-a11941fd63ecbc9af6a2b532a98a9cf45411f938-{{checksum ".buildcache/cache-keys/package-a11941fd63ecbc9af6a2b532a98a9cf45411f938"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-5a1666d67ac28507b7da6163f468e4f7b54ba2ca.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-5a1666d67ac28507b7da6163f468e4f7b54ba2ca-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_5a16_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-5a1666d67ac28507b7da6163f468e4f7b54ba2ca"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-5a1666d67ac28507b7da6163f468e4f7b54ba2ca.tar.gz
  website-docker-image:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    steps:
    - checkout
    - setup_remote_docker
    - run:
        command: |
          IMAGE_TAG="$(git rev-list -n1 HEAD -- website/Dockerfile website/package-lock.json)"
          echo "Using $IMAGE_TAG"
          if  [ "$CIRCLE_REPOSITORY_URL" != "git@github.com:hashicorp/vault.git" ]; then
            echo "Not Vault OSS Repo, not building website docker image"
          elif curl https://hub.docker.com/v2/repositories/hashicorp/vault-website/tags/$IMAGE_TAG -fsL > /dev/null; then
              echo "Dependencies have not changed, not building a new website docker image."
          else
              cd website/
              docker build -t hashicorp/vault-website:$IMAGE_TAG .
              docker tag hashicorp/vault-website:$IMAGE_TAG hashicorp/vault-website:latest
              docker login -u $WEBSITE_DOCKER_USER -p $WEBSITE_DOCKER_PASS
              docker push hashicorp/vault-website
          fi
        name: Build Docker Image if Necessary
  solaris_amd64_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: fffa6d15a1e6ba541a04147a0bbf06753491fc8c
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-fffa6d15a1e6ba541a04147a0bbf06753491fc8c-{{checksum ".buildcache/cache-keys/package-fffa6d15a1e6ba541a04147a0bbf06753491fc8c"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_aa96_{{checksum ".buildcache/cache-keys/copy-source-aa968bb05595b5023dc81ea955a264741bce97e0"}}
        - cache002-warm-go-build-vendor-cache_09ad_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-09ad7821425de281d98eef16457261f9582b1fb7"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-fffa6d15a1e6ba541a04147a0bbf06753491fc8c-{{checksum ".buildcache/cache-keys/package-fffa6d15a1e6ba541a04147a0bbf06753491fc8c"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-09ad7821425de281d98eef16457261f9582b1fb7.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-09ad7821425de281d98eef16457261f9582b1fb7-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_09ad_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-09ad7821425de281d98eef16457261f9582b1fb7"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-09ad7821425de281d98eef16457261f9582b1fb7.tar.gz
  test-go:
    machine: true
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/vault
    parallelism: 2
    steps:
    - run:
        command: |
          # If the branch being tested starts with ui/ or docs/ we want to exit the job without failing
          [[ "$CIRCLE_BRANCH" = ui/* || "$CIRCLE_BRANCH" = docs/* ]] && {
            # stop the job from this step
            circleci-agent step halt
          }
          # exit with success either way
          exit 0
        name: Check branch name
        working_directory: ~/
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          sudo rm -rf /usr/local/go
          sudo tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { sudo mkdir $GOPATH && sudo chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"

          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: |
          TZ=GMT date '+%Y%m%d' > /tmp/go-cache-key
        name: Compute test cache key
    - restore_cache:
        keys:
        - go-test-cache-date-v1-{{ checksum "/tmp/go-cache-key" }}
    - run:
        command: |
          set -x

          case "" in
          *-race*) VAULT_CI_GO_TEST_RACE=1;;
          esac

          # Install CircleCI CLI
          curl -sSL \
              "https://github.com/CircleCI-Public/circleci-cli/releases/download/v${CIRCLECI_CLI_VERSION}/circleci-cli_${CIRCLECI_CLI_VERSION}_linux_amd64.tar.gz" \
            | sudo tar --overwrite -xz \
              -C /usr/local/bin \
              "circleci-cli_${CIRCLECI_CLI_VERSION}_linux_amd64/circleci"

          # Split Go tests by prior test times
          package_names=$(go list \
              -tags "${GO_TAGS}" \
              ./... \
            | grep -v /integ \
            | grep -v /vendor/ \
            | sort \
            | circleci tests split --split-by=timings --timings-type=classname)

          # Install gotestsum
          curl -sSL "https://github.com/gotestyourself/gotestsum/releases/download/v${GOTESTSUM_VERSION}/gotestsum_${GOTESTSUM_VERSION}_linux_amd64.tar.gz" \
            | sudo tar --overwrite -xz -C /usr/local/bin gotestsum

          # Run tests
          make prep
          mkdir -p test-results/go-test
          CGO_ENABLED= \
            VAULT_ADDR= \
            VAULT_TOKEN= \
            VAULT_DEV_ROOT_TOKEN_ID= \
            VAULT_ACC= \
            GOCACHE=/tmp/go-cache \
            VAULT_TEST_LOG_DIR=/tmp/testlogs \
            gotestsum --format=short-verbose \
              --junitfile test-results/go-test/results.xml \
              --jsonfile test-results/go-test/results.json \
              -- \
              -tags "${GO_TAGS}" \
              -timeout=60m \
              -parallel=20 \
               \
              ${package_names}
        name: Run Go tests
        no_output_timeout: 60m
    - store_artifacts:
        path: test-results
    - store_test_results:
        path: test-results
    - store_artifacts:
        path: /tmp/testlogs
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.5546
    - GO_TAGS: ''
    - GO_VERSION: 1.14.7
    - GO111MODULE: 'off'
    - GOTESTSUM_VERSION: 0.5.2
  test-go-nightly:
    machine: true
    shell: /usr/bin/env bash -euo pipefail -c
    working_directory: /go/src/github.com/hashicorp/vault
    steps:
    - run:
        command: |
          # If the branch being tested starts with ui/ or docs/ we want to exit the job without failing
          [[ "$CIRCLE_BRANCH" = ui/* || "$CIRCLE_BRANCH" = docs/* ]] && {
            # stop the job from this step
            circleci-agent step halt
          }
          # exit with success either way
          exit 0
        name: Check branch name
        working_directory: ~/
    - run:
        command: |
          [ -n "$GO_VERSION" ] || { echo "You must set GO_VERSION"; exit 1; }
          # Install Go
          curl -sSLO "https://dl.google.com/go/go${GO_VERSION}.linux-amd64.tar.gz"
          sudo rm -rf /usr/local/go
          sudo tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"
          rm -f "go${GO_VERSION}.linux-amd64.tar.gz"
          GOPATH="/go"
          mkdir $GOPATH 2>/dev/null || { sudo mkdir $GOPATH && sudo chmod 777 $GOPATH; }
          echo "export GOPATH='$GOPATH'" >> "$BASH_ENV"
          echo "export PATH='$PATH:$GOPATH/bin:/usr/local/go/bin'" >> "$BASH_ENV"

          echo "$ go version"
          go version
        name: Setup Go
        working_directory: ~/
    - checkout
    - run:
        command: |
          TZ=GMT date '+%Y%m%d' > /tmp/go-cache-key
        name: Compute test cache key
    - restore_cache:
        keys:
        - go-test-cache-date-v1-{{ checksum "/tmp/go-cache-key" }}
    - run:
        command: |
          set -x

          case "" in
          *-race*) VAULT_CI_GO_TEST_RACE=1;;
          esac

          # Install CircleCI CLI
          curl -sSL \
              "https://github.com/CircleCI-Public/circleci-cli/releases/download/v${CIRCLECI_CLI_VERSION}/circleci-cli_${CIRCLECI_CLI_VERSION}_linux_amd64.tar.gz" \
            | sudo tar --overwrite -xz \
              -C /usr/local/bin \
              "circleci-cli_${CIRCLECI_CLI_VERSION}_linux_amd64/circleci"

          # Split Go tests by prior test times
          package_names=$(go list \
              -tags "${GO_TAGS}" \
              ./... \
            | grep -v /integ \
            | grep -v /vendor/ \
            | sort \
            | circleci tests split --split-by=timings --timings-type=classname)

          # Install gotestsum
          curl -sSL "https://github.com/gotestyourself/gotestsum/releases/download/v${GOTESTSUM_VERSION}/gotestsum_${GOTESTSUM_VERSION}_linux_amd64.tar.gz" \
            | sudo tar --overwrite -xz -C /usr/local/bin gotestsum

          # Run tests
          make prep
          mkdir -p test-results/go-test
          CGO_ENABLED= \
            VAULT_ADDR= \
            VAULT_TOKEN= \
            VAULT_DEV_ROOT_TOKEN_ID= \
            VAULT_ACC= \
            GOCACHE=/tmp/go-cache \
            VAULT_TEST_LOG_DIR=/tmp/testlogs \
            gotestsum --format=short-verbose \
              --junitfile test-results/go-test/results.xml \
              --jsonfile test-results/go-test/results.json \
              -- \
              -tags "${GO_TAGS}" \
              -timeout=60m \
              -parallel=20 \
               \
              ${package_names}
        name: Run Go tests
        no_output_timeout: 60m
    - save_cache:
        key: go-test-cache-date-v1-{{ checksum "/tmp/go-cache-key" }}
        paths:
        - /tmp/go-cache
        when: always
    - store_artifacts:
        path: test-results
    - store_test_results:
        path: test-results
    - store_artifacts:
        path: /tmp/testlogs
    environment:
    - CIRCLECI_CLI_VERSION: 0.1.5546
    - GO_TAGS: ''
    - GO_VERSION: 1.14.7
    - GO111MODULE: 'off'
    - GOTESTSUM_VERSION: 0.5.2
  netbsd_amd64_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: dc3a69ebdc0a3822522ea90cc911e6a2504ff8cd
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-dc3a69ebdc0a3822522ea90cc911e6a2504ff8cd-{{checksum ".buildcache/cache-keys/package-dc3a69ebdc0a3822522ea90cc911e6a2504ff8cd"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_ec8b_{{checksum ".buildcache/cache-keys/copy-source-ec8b88767157efd2acd52682c7a351122e0e74e8"}}
        - cache002-warm-go-build-vendor-cache_08c6_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-08c6940fec493feff63dedc634d45ceeaa324d50"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-dc3a69ebdc0a3822522ea90cc911e6a2504ff8cd-{{checksum ".buildcache/cache-keys/package-dc3a69ebdc0a3822522ea90cc911e6a2504ff8cd"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-08c6940fec493feff63dedc634d45ceeaa324d50.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-08c6940fec493feff63dedc634d45ceeaa324d50-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_08c6_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-08c6940fec493feff63dedc634d45ceeaa324d50"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-08c6940fec493feff63dedc634d45ceeaa324d50.tar.gz
  openbsd_amd64_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 4a09f8a877207aa3e5511fe093e7248a4c8d8db0
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-4a09f8a877207aa3e5511fe093e7248a4c8d8db0-{{checksum ".buildcache/cache-keys/package-4a09f8a877207aa3e5511fe093e7248a4c8d8db0"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_e6b7_{{checksum ".buildcache/cache-keys/copy-source-e6b7d87d5cadc7f42949febe0999646169448648"}}
        - cache002-warm-go-build-vendor-cache_77da_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-77daeedc6f64f01225b865fa626137b5bdd26224"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-4a09f8a877207aa3e5511fe093e7248a4c8d8db0-{{checksum ".buildcache/cache-keys/package-4a09f8a877207aa3e5511fe093e7248a4c8d8db0"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-77daeedc6f64f01225b865fa626137b5bdd26224.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-77daeedc6f64f01225b865fa626137b5bdd26224-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_77da_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-77daeedc6f64f01225b865fa626137b5bdd26224"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-77daeedc6f64f01225b865fa626137b5bdd26224.tar.gz
  netbsd_386_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 0ba2003857d2baed36f1c8c59765117d05fca5d1
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-0ba2003857d2baed36f1c8c59765117d05fca5d1-{{checksum ".buildcache/cache-keys/package-0ba2003857d2baed36f1c8c59765117d05fca5d1"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_1db0_{{checksum ".buildcache/cache-keys/copy-source-1db028e81ffe7c030dc4a86e0ce8b9c52e6162b8"}}
        - cache002-warm-go-build-vendor-cache_267c_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-267ca9059967366c6225a90095873984c29a2103"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-0ba2003857d2baed36f1c8c59765117d05fca5d1-{{checksum ".buildcache/cache-keys/package-0ba2003857d2baed36f1c8c59765117d05fca5d1"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-267ca9059967366c6225a90095873984c29a2103.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-267ca9059967366c6225a90095873984c29a2103-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_267c_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-267ca9059967366c6225a90095873984c29a2103"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-267ca9059967366c6225a90095873984c29a2103.tar.gz
  freebsd_arm_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: 20b84978b1b77380d2963c90721181a835fab182
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-20b84978b1b77380d2963c90721181a835fab182-{{checksum ".buildcache/cache-keys/package-20b84978b1b77380d2963c90721181a835fab182"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_84bb_{{checksum ".buildcache/cache-keys/copy-source-84bb14392a8ee8bb06ae2a4e1f066a337727a2f0"}}
        - cache002-warm-go-build-vendor-cache_b2da_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-b2dad22d23e6728e45f8a0cdcec7a19ea785bb8d"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-20b84978b1b77380d2963c90721181a835fab182-{{checksum ".buildcache/cache-keys/package-20b84978b1b77380d2963c90721181a835fab182"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-b2dad22d23e6728e45f8a0cdcec7a19ea785bb8d.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-b2dad22d23e6728e45f8a0cdcec7a19ea785bb8d-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_b2da_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-b2dad22d23e6728e45f8a0cdcec7a19ea785bb8d"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-b2dad22d23e6728e45f8a0cdcec7a19ea785bb8d.tar.gz
  windows_amd64_package:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
    - PACKAGE_SPEC_ID: b2d3a544e74f5fa8cde087067748a7b9948f4ae4
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-package-cache-key
        name: Write package cache key
    - restore_cache:
        key: cache002-package-b2d3a544e74f5fa8cde087067748a7b9948f4ae4-{{checksum ".buildcache/cache-keys/package-b2d3a544e74f5fa8cde087067748a7b9948f4ae4"}}
    - run:
        command: |
          if ! { PKG=$(find .buildcache/packages/store -maxdepth 1 -mindepth 1 -name '*.zip' 2> /dev/null) && [ -n "$PKG" ]; }; then
            echo "No package found, continuing with build."
            exit 0
          fi
          echo "Package already cached, skipping build."
          circleci-agent step halt
        name: Check the cache status.
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-copy-source_24ee_{{checksum ".buildcache/cache-keys/copy-source-24ee2226050258af0c84f8ff9b534d3f77de96f2"}}
        - cache002-warm-go-build-vendor-cache_fb53_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-fb53168fd56c4ceba4e391f3429d57e658f4bc0d"}}
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: make -C packages*.lock load-builder-cache
    - run:
        command: make -C packages*.lock package
    - run:
        command: ls -lahR .buildcache/packages
    - save_cache:
        key: cache002-package-b2d3a544e74f5fa8cde087067748a7b9948f4ae4-{{checksum ".buildcache/cache-keys/package-b2d3a544e74f5fa8cde087067748a7b9948f4ae4"}}
        paths:
        - .buildcache/packages/store
    - run:
        command: |
          if [ -f .buildcache/archives/08-warm-go-build-vendor-cache-fb53168fd56c4ceba4e391f3429d57e658f4bc0d.tar.gz ]; then
            echo "Builder image already cached, skipping cache step."
            circleci-agent step halt
          fi
        name: Check builder cache status
    - run:
        command: make -f packages*.lock/layer.mk 08-warm-go-build-vendor-cache-fb53168fd56c4ceba4e391f3429d57e658f4bc0d-save
    - save_cache:
        key: cache002-warm-go-build-vendor-cache_fb53_{{checksum ".buildcache/cache-keys/warm-go-build-vendor-cache-fb53168fd56c4ceba4e391f3429d57e658f4bc0d"}}
        paths:
        - .buildcache/archives/08-warm-go-build-vendor-cache-fb53168fd56c4ceba4e391f3429d57e658f4bc0d.tar.gz
  pre-flight-checks:
    docker:
    - image: circleci/buildpack-deps
    environment:
    - CCI_VERSION: 0.1.5691
    shell: /usr/bin/env bash -euo pipefail
    steps:
    - checkout
    - run:
        command: |
          export CCI_PATH=/tmp/circleci-cli/$CCI_VERSION
          mkdir -p $CCI_PATH
          NAME=circleci-cli_${CCI_VERSION}_${ARCH}
          URL=$BASE/v${CCI_VERSION}/${NAME}.tar.gz
          curl -sSL $URL \
            | tar --overwrite --strip-components=1 -xz -C $CCI_PATH "${NAME}/circleci"
          # Add circleci to the path for subsequent steps.
          echo "export PATH=$CCI_PATH:\$PATH" >> $BASH_ENV
          # Done, print some debug info.
          set -x
          . $BASH_ENV
          which circleci
          circleci version
        environment:
          ARCH: linux_amd64
          BASE: https://github.com/CircleCI-Public/circleci-cli/releases/download
        name: Install CircleCI CLI
    - run:
        command: make ci-verify
  cache-builder-images:
    docker:
    - image: circleci/buildpack-deps
    shell: /usr/bin/env bash -euo pipefail -c
    steps:
    - setup_remote_docker
    - checkout
    - run:
        command: make -C packages*.lock write-builder-cache-keys
        name: Write builder layer cache keys
    - restore_cache:
        keys:
        - cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        - cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        - cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        - cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        - cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        - cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        - cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        - cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
    - run:
        command: |
          if [ -f .buildcache/archives/07-build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90.tar.gz ]; then
            echo "Exact match found in cache, skipping build."
            circleci-agent step halt
          else
            echo "No exact match found, proceeding with build."
          fi
        name: Finish early if loaded exact match from cache.
    - run:
        command: LAYER_SPEC_ID=07-build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90 make -C packages*.lock load-builder-cache
    - run:
        command: make -f packages*.lock/layer.mk 00-base-06c792d6756fe70002ca3d73580e60e3f7ce80db-image
    - run:
        command: make -f packages*.lock/layer.mk 01-install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2-image
    - run:
        command: make -f packages*.lock/layer.mk 02-install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220-image
    - run:
        command: make -f packages*.lock/layer.mk 03-set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a-image
    - run:
        command: make -f packages*.lock/layer.mk 04-install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f-image
    - run:
        command: make -f packages*.lock/layer.mk 05-ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475-image
    - run:
        command: make -f packages*.lock/layer.mk 06-build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72-image
    - run:
        command: make -f packages*.lock/layer.mk 07-build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90-image
    - run:
        command: make -f packages*.lock/layer.mk 07-build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90-save
    - save_cache:
        key: cache002-build-static-assets_0f00_{{checksum ".buildcache/cache-keys/build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90"}}
        paths:
        - .buildcache/archives/07-build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90.tar.gz
    - run:
        command: mv .buildcache/archives/07-build-static-assets-0f006f5921ec8344bcb69324fd8c209cb65a7b90.tar.gz .buildcache/archives/06-build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72.tar.gz
    - save_cache:
        key: cache002-build-ui_afb3_{{checksum ".buildcache/cache-keys/build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72"}}
        paths:
        - .buildcache/archives/06-build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72.tar.gz
    - run:
        command: mv .buildcache/archives/06-build-ui-afb31abc0c89030c65ec2ef6253beadf908a1a72.tar.gz .buildcache/archives/05-ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475.tar.gz
    - save_cache:
        key: cache002-ui-dependencies_af47_{{checksum ".buildcache/cache-keys/ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475"}}
        paths:
        - .buildcache/archives/05-ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475.tar.gz
    - run:
        command: mv .buildcache/archives/05-ui-dependencies-af47e1ff0c23d814e40bb115dea6951b4c605475.tar.gz .buildcache/archives/04-install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f.tar.gz
    - save_cache:
        key: cache002-install-yarn_ed76_{{checksum ".buildcache/cache-keys/install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f"}}
        paths:
        - .buildcache/archives/04-install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f.tar.gz
    - run:
        command: mv .buildcache/archives/04-install-yarn-ed764f349fb7ddc37dc397918f7ab263ed4f243f.tar.gz .buildcache/archives/03-set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a.tar.gz
    - save_cache:
        key: cache002-set-workdir_476f_{{checksum ".buildcache/cache-keys/set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a"}}
        paths:
        - .buildcache/archives/03-set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a.tar.gz
    - run:
        command: mv .buildcache/archives/03-set-workdir-476f5bc5b97439e3fdae7a3faa3fc39ac4dcb78a.tar.gz .buildcache/archives/02-install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220.tar.gz
    - save_cache:
        key: cache002-install-go-tools_11d7_{{checksum ".buildcache/cache-keys/install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220"}}
        paths:
        - .buildcache/archives/02-install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220.tar.gz
    - run:
        command: mv .buildcache/archives/02-install-go-tools-11d7cb8409864c13e65360a13b2b7c00594b1220.tar.gz .buildcache/archives/01-install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2.tar.gz
    - save_cache:
        key: cache002-install-go_8489_{{checksum ".buildcache/cache-keys/install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2"}}
        paths:
        - .buildcache/archives/01-install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2.tar.gz
    - run:
        command: mv .buildcache/archives/01-install-go-848968fe5a51358722bc1f7c1c6accf7745e9ee2.tar.gz .buildcache/archives/00-base-06c792d6756fe70002ca3d73580e60e3f7ce80db.tar.gz
    - save_cache:
        key: cache002-base_06c7_{{checksum ".buildcache/cache-keys/base-06c792d6756fe70002ca3d73580e60e3f7ce80db"}}
        paths:
        - .buildcache/archives/00-base-06c792d6756fe70002ca3d73580e60e3f7ce80db.tar.gz
    environment:
    - AUTO_INSTALL_TOOLS: 'YES'
    - PRODUCT_REVISION: ''
workflows:
  build-standalone:
    jobs:
    - cache-builder-images:
        filters:
          branches:
            only:
            - /build-.*/
            - /ci.*/
    - darwin_386_package:
        requires:
        - cache-builder-images
    - darwin_amd64_package:
        requires:
        - cache-builder-images
    - freebsd_386_package:
        requires:
        - cache-builder-images
    - freebsd_amd64_package:
        requires:
        - cache-builder-images
    - freebsd_arm_package:
        requires:
        - cache-builder-images
    - linux_386_package:
        requires:
        - cache-builder-images
    - linux_amd64_package:
        requires:
        - cache-builder-images
    - linux_arm_package:
        requires:
        - cache-builder-images
    - linux_arm64_package:
        requires:
        - cache-builder-images
    - netbsd_386_package:
        requires:
        - cache-builder-images
    - netbsd_amd64_package:
        requires:
        - cache-builder-images
    - openbsd_386_package:
        requires:
        - cache-builder-images
    - openbsd_amd64_package:
        requires:
        - cache-builder-images
    - solaris_amd64_package:
        requires:
        - cache-builder-images
    - windows_386_package:
        requires:
        - cache-builder-images
    - windows_amd64_package:
        requires:
        - cache-builder-images
    - bundle-releases:
        requires:
        - darwin_386_package
        - darwin_amd64_package
        - freebsd_386_package
        - freebsd_amd64_package
        - freebsd_arm_package
        - linux_386_package
        - linux_amd64_package
        - linux_arm_package
        - linux_arm64_package
        - netbsd_386_package
        - netbsd_amd64_package
        - openbsd_386_package
        - openbsd_amd64_package
        - solaris_amd64_package
        - windows_386_package
        - windows_amd64_package
  ci:
    jobs:
    - pre-flight-checks
    - install-ui-dependencies:
        requires:
        - pre-flight-checks
    - build-go-dev:
        requires:
        - pre-flight-checks
    - test-ui:
        requires:
        - install-ui-dependencies
        - build-go-dev
    - test-ui-browserstack:
        filters:
          branches:
            ignore: /pull\/[0-9]+/
        requires:
        - install-ui-dependencies
        - build-go-dev
    - test-go:
        requires:
        - build-go-dev
    - test-go-race:
        filters:
          branches:
            ignore:
            - /^docs\/.*/
            - /^ui\/.*/
        requires:
        - build-go-dev
    - website-docker-image:
        filters:
          branches:
            only:
            - master
        context: vault-docs
    - algolia-index:
        filters:
          branches:
            only:
            - stable-website
        context: vault-docs
  nightly-cachebuilder:
    jobs:
    - pre-flight-checks
    - test-go-nightly
    triggers:
    - schedule:
        cron: 0 9 * * *
        filters:
          branches:
            only:
            - master
  version: 2
